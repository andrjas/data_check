<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Usage - data_check</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">data_check</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Usage</a>
                            </li>
                            <li class="navitem">
                                <a href="../csv_checks/" class="nav-link">CSV checks</a>
                            </li>
                            <li class="navitem">
                                <a href="../pipelines/" class="nav-link">Pipelines</a>
                            </li>
                            <li class="navitem">
                                <a href="../howtos/" class="nav-link">HowTos</a>
                            </li>
                            <li class="navitem">
                                <a href="../example/" class="nav-link">Examples</a>
                            </li>
                            <li class="navitem">
                                <a href="../development/" class="nav-link">Development</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../install/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../csv_checks/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#commands" class="nav-link">Commands</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#exit-codes" class="nav-link">Exit codes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#logging" class="nav-link">Logging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#loading-data-into-tables" class="nav-link">Loading data into tables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#executing-arbitrary-sql-code" class="nav-link">Executing arbitrary SQL code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="usage">Usage</h1>
<h2 id="commands">Commands</h2>
<ul>
<li><code>data_check</code> - Run data_check against the default connection in the <em>checks</em> folder.</li>
<li><code>data_check some_folder</code> - Run data_check against the default connection in the <em>some_folder</em> folder.</li>
<li><code>data_check some_folder/some_file.sql</code> - Run data_check against the default connection for a single test.</li>
<li><code>data_check -c/--connection CONNECTION</code> - use another connection than the default.</li>
<li><code>data_check -n/--workers WORKERS</code> - use WORKERS threads to run the queries (default: 4).</li>
<li><code>data_check --print</code> - print failed results data.</li>
<li><code>data_check --print-format FORMAT</code> - format for printing failed results (csv (default), pandas, json).</li>
<li><code>data_check --print-json</code> - shortcut for "--print --print-format json".</li>
<li><code>data_check --diff</code> - print only the different columns for failed results. Use with --print.</li>
<li><code>data_check -g/--generate</code> - generate expectation files if they don't exist.</li>
<li><code>data_check --force</code> - when set, --generate will overwrite files.</li>
<li><code>data_check --config CONFIG</code> - config file to use (default: data_check.yml).</li>
<li><code>data_check --load PATH --table</code>-  load table data from a csv into the table</li>
<li><code>data_check --load-mode MODE</code> -  how to load the table: truncate (default), append or replace. Use with --load or --load-tables.</li>
<li><code>data_check --load-tables some_folder/or/some_file.csv</code>-  load tables from a list of csv files.</li>
<li><code>data_check --sql-files some_folder/or/some_file.sql</code> - run any SQL script in a list of SQL files.</li>
<li><code>data_check --sql-file some_folder/or/some_file.sql</code> - alias for --sql-files.</li>
<li><code>data_check --sql "SQL statement"</code> - run any SQL statement. Print result as CSV if it is a query.</li>
<li><code>data_check -o/--output PATH</code> - output path for --sql.</li>
<li><code>data_check -W/--write-check PATH</code> - create a check from the --sql statement (SQL and CSV file).</li>
<li><code>data_check --ping</code> - tries to connect to the database.</li>
<li><code>data_check --quiet</code> - do not print any output.</li>
<li><code>data_check --verbose</code> - print verbose output.</li>
<li><code>data_check --traceback</code> - print traceback output for debugging.</li>
<li><code>data_check --log LOGFILE</code> - write output to a log file.</li>
<li><code>data_check --version</code> - Show the version and exit.</li>
<li><code>data_check --help</code> - show this help message and exit.</li>
</ul>
<h2 id="exit-codes">Exit codes</h2>
<p>Possible exit codes:</p>
<p><strong>Exit code 0:</strong> All tests run successfully.<br/>
<strong>Exit code 1:</strong> At least one test failed.</p>
<h2 id="logging">Logging</h2>
<p><code>--log</code> will write the output to a log file and to the console. With <code>--quiet</code> the output will only be printed to the log file. If the file exists, the output will be appended.</p>
<p>You can also set the log file in data_check.yml:</p>
<pre><code class="language-yaml">log: logfile.txt
</code></pre>
<p>Failed results and tracebacks are always written to the log file, even when the parameters <code>--print</code> and <code>--traceback</code> are not used.</p>
<h2 id="loading-data-into-tables">Loading data into tables</h2>
<p>Sometimes you need to populate tables with some data before running pipeline tests. With data_check you can use CSV or Excel files to load data into tables. The <a href="./#csv-format">CSV format</a> is the same as used for testing. The header in the CSV file or the first row in the Excel file must match the columns in the table. Additionally, Excel cells can use its native date/datetime format.</p>
<p>If the table doesn't exist, it will be created. The schema and table names are always case-insensitive, as long as the database supports it. Otherwise, they are lowercased.</p>
<h3 id="loading-data-into-a-single-table">Loading data into a single table</h3>
<p>To load data from some CSV or Excel file into a table, you can use <code>data_check --load path/to/some_file.[csv/xlsx] --table schema.table_name</code>. This will truncate the table and load the content of the file into the table. You can specify different <a href="./#load-modes">load modes</a> if you do not want to truncate the table.</p>
<h3 id="loading-data-into-multiple-tables">Loading data into multiple tables</h3>
<p>You can use multiple CSV and Excel files or a whole folder to load the data into tables. The table name will be derived from the file name.</p>
<ul>
<li><code>data_check --load-tables path/schema.table_1.csv</code> - this will load the data from the CSV file into the table schema.table_1</li>
<li><code>data_check --load-tables path/schema.table_2.xlsx</code> - this will load the data from the Excel file into the table schema.table_2</li>
<li><code>data_check --load-tables path/to/some_folder</code> - this will load the data from all CSV and Excel files in this folder into tables matching the file names.</li>
</ul>
<p>The path will be searched recursively for CSV and Excel files. The folder structure doesn't matter when matching the table names, only the file name matters.</p>
<h3 id="load-modes">Load modes</h3>
<p>There are multiple modes that control the data loading:</p>
<ul>
<li>truncate - truncate the table before loading the data.</li>
<li>replace - drop the table and recreate it based on the columns in the CSV or Excel file.</li>
<li>append - do not touch the table before loading the data.</li>
</ul>
<p>By default, the tables will be truncated before loading the data. You can use the other modes with <code>--load-mode</code>:</p>
<p><code>data_check --load file.csv --table table_name --load-mode replace</code>
<code>data_check --load-tables path/to/tables_folder --load-mode append</code></p>
<h3 id="csv-and-data-types">CSV and data types</h3>
<p>When loading data from CSV files, data_check (or more precisely: <a href="https://pandas.pydata.org/">pandas</a>) will infer the data types from the file.
When loading the data into the table, the database will usually implicitly convert the data types.
This works good for simple data types like strings and numbers.</p>
<p>If you need to load date types (or timestamps) and the table has a date column, data_check will try to convert these columns in the CSV file into a datetime.
This doesn't work when using <code>--load-mode replace</code> since the table will be dropped before it can be analyzed. This will probably result in a varchar column instead of date.</p>
<p>Use <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> for dates, like for [CSV checks]((csv_checks.md#csv-format)</p>
<h2 id="executing-arbitrary-sql-code">Executing arbitrary SQL code</h2>
<p>You can run any SQL file against the database by using the <code>--sql-files</code> command:</p>
<p><code>data_check --sql-files sql_file.sql other_file.sql</code></p>
<p>or a whole folder recursively:</p>
<p><code>data_check --sql-files some/folder/with/sql_files</code></p>
<p>All files are run in parallel. If you have dependencies between the files, data_check must be called sequentially for each file.</p>
<p>Multiple statements in a SQL file usually must be inside an anonymous block. MySQL doesn't support this however.</p>
<p><code>--sql-file</code> is an alias for <code>--sql-files</code>. Use it to indicate, that you only want to run a single file.</p>
<p>You can also run a SQL statement directly from the command line:</p>
<p><code>data_check --sql "select * from tableX"</code></p>
<p>This will execute the query and, if it is a query, print the result as CSV. You can also write the result into a file:</p>
<p><code>data_check --sql "select * from tableX" --output some_file.csv</code></p>
<p>You can use both <a href="../csv_checks/#templates">templates</a> and <a href="../csv_checks/#lookups">lookups</a> with <code>--sql</code> and <code>--sql-files</code>.</p>
<h3 id="generating-a-csv-check-from-a-sql-statement">Generating a CSV check from a SQL statement</h3>
<p>You can use <code>--sql</code> to create a CSV check:</p>
<p><code>data_check --sql "select * from tableX" --write-check some_check.sql</code></p>
<p>This writes the SQL statement into <code>some_check.sql</code> and the result as CSV into <code>some_check.csv</code>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
